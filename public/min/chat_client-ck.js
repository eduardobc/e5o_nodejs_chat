function chat_refresh_timer_close(){window.clearInterval(chat_time_close_innactivity),chat_time_close_innactivity=null,chat_time_close_innactivity=setTimeout(function(){this_email=$(".chat-email").val(),socket.emit("disc",{id:this_socket_id,email:this_email})},chat_time_innactivity)}function chat_close_window(){$(".olab-close-chat-init").fadeOut(),$(".chat-step-a").fadeIn(),$(".chat-step-b").fadeOut(),$(".chat-step-b").html(""),$(".chat-controls-ajax").stop().dequeue().animate({height:"0px"}),bottom="50px",$(window).width()<768&&(bottom="100px"),$(".chat-button-container").stop().dequeue().animate({width:"200px",bottom:bottom},function(){$(this).css({bottom:"",left:""})}),$(".chat-button-container").css({position:"absolute","z-index":"5"}),chat_open=0,agent_id="",window.clearInterval(chat_time_close_innactivity),chat_time_close_innactivity=null}function chat_init_controller(){socket=io.connect(server_address),chat_listenner_init(),socket.on("connecting",function(){console.log("connecting:")}),socket.on("connect",function(){this_socket_id=socket.socket.sessionid,console.log("connect: this_socket_id"+this_socket_id)}),socket.on("connect_failed",function(){console.log("Client connect_failed")}),socket.on("reconnect_failed",function(){console.log("Client reconnect_failed")}),socket.on("reconnecting",function(){console.log("reconnecting")}),socket.on("reconnect",function(){console.log("reconnect")}),socket.on("disconnect",function(){console.log("disconnect"),$(".chat-content").append("<p class='left'>: Error de conexion!</p>"),socket.disconnect(),setTimeout(function(){chat_close_window()},1e4)}),$(".chat-sent").on("click",function(){chat_sent_message()}),$(".chat-close-conn").on("click",function(){this_email=$(".chat-email").val(),socket.emit("disc",{id:this_socket_id,email:this_email})}),$(".chat-message").keypress(function(t){var e=t.keyCode?t.keyCode:t.which;"13"==e&&chat_sent_message()}),chat_find_assoc_with_agent()}function chat_find_assoc_with_agent(){this_name=$(".chat-name").val(),this_email=$(".chat-email").val(),socket.emit("type_user",{message:"client",name:this_name,email:this_email})}function chat_sent_message(){""!=$(".chat-message").val()&&(this_name=$(".chat-name").val(),ids_to_sent=$(".chat-current-users").val(),this_email=$(".chat-email").val(),""!=agent_id?(msg=$(".chat-message").val(),$(".chat-message").val(""),console.log({message:msg,ids:[agent_id],name:this_name,email:this_email,im:"client"}),socket.emit("send",{message:msg,ids:[agent_id],name:this_name,email:this_email,im:"client"})):alert("No hay Agentes disponibles."))}function chat_listenner_init(){socket.on("message",function(t){t.message&&(type="right"==t.type?"right":"left",$(".chat-content").append("<p class='"+type+"'><span>"+t.name+"</span><br />"+t.message+"</p>"),$(".chat-content").stop().dequeue().scrollTo($(".chat-content p").last(),500,{offset:0}),chat_refresh_timer_close()),t.this_socket_id&&(this_socket_id=t.this_socket_id,console.log("My ID="+this_socket_id)),t.agent_assoc_id&&("-"!=t.agent_assoc_id?(agent_id=t.agent_assoc_id,$(".chat-content").before("<label class='id_agent'>"+t.name+"</label>"),console.log("AGEND-ID-ASSOC="+agent_id+":"+t.name)):(agent_id="",chat_close_window(),console.log("NO hay agentes disponibles"),$(".button-open-window-chat").stop().dequeue().fadeOut(function(){$(this).hide()}),$(".olab-message-without-agents").stop().dequeue().animate({height:"65px"},function(){setTimeout(function(){$(".button-open-window-chat").fadeIn(),$(".olab-message-without-agents").stop().dequeue().animate({height:"0px"})},2e4)}))),t.disc&&(console.log(t),chat_close_window(),socket.disconnect()),t.message_disc&&(type="right"==t.type?"right":"left",$(".chat-content").append("<p class='"+type+"'>"+t.message_disc+"</p>"),$(".chat-content").stop().dequeue().scrollTo($(".chat-content p").last(),500,{offset:0}),chat_refresh_timer_close(),socket.disconnect(),setTimeout(function(){chat_close_window()},5e3))})}var server_address="http://www.olab.com.mx:3000",messages=[],socket=null,this_socket_id="",this_name="",this_email="",agent_id="",chat_time_innactivity=3e5,chat_time_close_innactivity=null;setTimeout(function(){console.log("chat_init_controller()"),chat_init_controller()},1e3);