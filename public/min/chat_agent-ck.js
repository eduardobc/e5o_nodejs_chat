function chat_init_controller(){socket=io.connect(server_address),chat_listenner_init(),socket.on("connecting",function(){console.log("connecting:")}),socket.on("connect",function(){$(".chat_status").html("Connectado"),this_socket_id=socket.socket.sessionid,console.log("connect: this_socket_id"+this_socket_id)}),socket.on("connect_failed",function(){console.log("Client connect_failed")}),socket.on("reconnect_failed",function(){console.log("Client reconnect_failed")}),socket.on("reconnecting",function(){console.log("reconnecting")}),socket.on("reconnect",function(){console.log("reconnect")}),socket.on("disconnect",function(){console.log("disconnect"),$(".chat_status").html("Error de conexion!"),$(".chat_conn").html("Vuelve a Iniciar"),$(".chat-container").fadeOut(function(){$(this).remove()}),socket.disconnect(),total_clients_conn=0,$(".clients-num").html("Clientes")}),$(".chat-type-agent").on("click",function(){this_name=$(".chat-name").val(),this_email=$(".chat-email").val(),olab_form_chat_validate_email({user_email:this_email,user_name:this_name},function(t){t.valid_name&&t.valid_email?socket.emit("type_user",{message:"agent",name:this_name,email:this_email}):(t.valid_name||($(".name-error").html("Nombre esta vacio.  "),setTimeout(function(){$(".name-error").html("")},7e3)),t.valid_email||($(".email-error").html("email no valido."),setTimeout(function(){$(".email-error").html("")},7e3)))})})}function chat_scroll_init(){$(".right").on("click",function(){280*total_clients_conn>scroll_chats&&(scroll_chats+=280),$(".container-overflow").stop().dequeue().scrollTo(scroll_chats+"px",500,{offset:0})}),$(".left").on("click",function(){scroll_chats>250&&(scroll_chats-=280),$(".container-overflow").stop().dequeue().scrollTo(scroll_chats+"px",500,{offset:0})})}function chat_init_controllers_individual_chat(t){$("#"+t).children(".chat-message").keypress(function(t){var e=t.keyCode?t.keyCode:t.which;"13"==e&&chat_sent_message($(this))}),$("#"+t).children(".chat-button-send").on("click",function(){console.log($(this)),chat_sent_message($(this))}),$("#"+t).children(".close-this").on("click",function(){close_single_chat($(this).parent().attr("id"))})}function chat_sent_message(t){ids_to_sent=[t.parent().attr("id")],message=t.parent().children(".chat-message").val(),this_name=$(".chat-name").val(),this_email=$(".chat-email").val(),console.log(ids_to_sent),"null"!=$.type(ids_to_sent)?(t.parent().children(".chat-message").val(""),socket.emit("send",{message:message,ids:ids_to_sent,name:this_name,email:this_email,im:"agent"})):""!=agent_id&&alert("No hay Clientes disponibles.")}function chat_listenner_init(){socket.on("message",function(t){t.client_assoc_id&&(total_clients_more_update(),chat_client_structure='<div style="display: inline-block; width: 250px; height:300px;" class="chat-container" id="'+t.client_assoc_id+'"><img src="'+server_address+'/olab_close_icon.png" class="close-this"><label class="client-data">'+t.name+'</label><div class="chat-messages"></div><input type="text" class="chat-message" placeholder="Tu mensaje"><button class="chat-button-send">Enviar</button></div>',clients_ids_assoc[t.client_assoc_id]="Client",$(".chats-container").width($(".chats-container").width()+400+"px"),$(".chats-container").append(chat_client_structure),chat_init_controllers_individual_chat(t.client_assoc_id),$("#"+t.client_assoc_id).fadeIn()),t.this_socket_id&&(this_socket_id=t.this_socket_id,console.log("My ID="+t.this_socket_id)),t.message?(id_client=t.who,type="right"==t.type?"right":"left",$("#"+id_client).children(".chat-messages").append("<p class='"+type+"'><span>"+t.name+"</span><br />"+t.message+"</p>"),$("#"+id_client).children(".chat-messages").stop().dequeue().scrollTo($("#"+id_client).children(".chat-messages").children("p").last(),500,{offset:0})):console.log(t),t.disc&&(id_client=t.disc,$("#"+id_client).css({"background-color":"#F49C00"}),total_clients_less_update()),t.message_disc&&(id_client=t.who,$("#"+id_client).children(".chat-messages").append(t.message_disc+"<br />"),$("#"+id_client).css({"background-color":"#F49C00"}),total_clients_less_update()),t.status&&$(".chat_status").html(t.status),t.assoc&&$(".chat_conn").html("Sincronizado")})}function close_single_chat(t){$("#"+t).fadeOut(function(){$(this).remove(),$(".chats-container").width($(".chats-container").width()-400+"px"),scroll_chats>250&&(scroll_chats-=280)}),console.log({client_id:t}),total_clients_less_update(),socket.emit("disc_client",{client_id:t})}function total_clients_more_update(){total_clients_conn+=1,$(".clients-num").html("Clientes - "+total_clients_conn)}function total_clients_less_update(){total_clients_conn-=1,$(".clients-num").html(0>=total_clients_conn?"Clientes":"Clientes - "+total_clients_conn)}function olab_form_chat_validate_email(t,e){var n=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;e({valid_name:""!=t.user_name?!0:!1,valid_email:n.test(t.user_email)})}!function(t){function e(t){return"object"==typeof t?t:{top:t,left:t}}var n=t.scrollTo=function(e,n,s){t(window).scrollTo(e,n,s)};n.defaults={axis:"xy",duration:parseFloat(t.fn.jquery)>=1.3?0:1,limit:!0},n.window=function(e){return t(window)._scrollable()},t.fn._scrollable=function(){return this.map(function(){var e=this,n=!e.nodeName||-1!=t.inArray(e.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!n)return e;var s=(e.contentWindow||e).document||e.ownerDocument||e;return/webkit/i.test(navigator.userAgent)||"BackCompat"==s.compatMode?s.body:s.documentElement})},t.fn.scrollTo=function(s,i,c){return"object"==typeof i&&(c=i,i=0),"function"==typeof c&&(c={onAfter:c}),"max"==s&&(s=9e9),c=t.extend({},n.defaults,c),i=i||c.duration,c.queue=c.queue&&c.axis.length>1,c.queue&&(i/=2),c.offset=e(c.offset),c.over=e(c.over),this._scrollable().each(function(){function o(t){l.stop().dequeue().animate(h,i,c.easing,t&&function(){t.call(this,r,c)})}if(null!=s){var a=this,l=t(a),r=s,_,h={},d=l.is("html,body");switch(typeof r){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(r)){r=e(r);break}if(r=t(r,this),!r.length)return;case"object":(r.is||r.style)&&(_=(r=t(r)).offset())}t.each(c.axis.split(""),function(t,e){var s="x"==e?"Left":"Top",i=s.toLowerCase(),u="scroll"+s,m=a[u],f=n.max(a,e);if(_)h[u]=_[i]+(d?0:m-l.offset()[i]),c.margin&&(h[u]-=parseInt(r.css("margin"+s))||0,h[u]-=parseInt(r.css("border"+s+"Width"))||0),h[u]+=c.offset[i]||0,c.over[i]&&(h[u]+=r["x"==e?"width":"height"]()*c.over[i]);else{var g=r[i];h[u]=g.slice&&"%"==g.slice(-1)?parseFloat(g)/100*f:g}c.limit&&/^\d+$/.test(h[u])&&(h[u]=h[u]<=0?0:Math.min(h[u],f)),!t&&c.queue&&(m!=h[u]&&o(c.onAfterFirst),delete h[u])}),o(c.onAfter)}}).end()},n.max=function(e,n){var s="x"==n?"Width":"Height",i="scroll"+s;if(!t(e).is("html,body"))return e[i]-t(e)[s.toLowerCase()]();var c="client"+s,o=e.ownerDocument.documentElement,a=e.ownerDocument.body;return Math.max(o[i],a[i])-Math.min(o[c],a[c])}}(jQuery),jQuery(function(t){t.easing.elasout=function(t,e,n,s,i){var c=1.70158,o=0,a=s;if(0==e)return n;if(1==(e/=i))return n+s;if(o||(o=.9*i),a<Math.abs(s)){a=s;var c=o/4}else var c=o/(2*Math.PI)*Math.asin(s/a);return a*Math.pow(2,-10*e)*Math.sin(2*(e*i-c)*Math.PI/o)+s+n}});var messages=[],socket=null,this_socket_id="",this_name="",this_email="",clients_ids_assoc=[],total_clients_conn=0,server_address="http://www.olab.com.mx:3000";$(window).load(function(){chat_init_controller(),chat_scroll_init()});var scroll_chats=0;